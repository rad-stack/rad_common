#!/usr/bin/env ruby
require 'fileutils'

def system!(*args)
  system(*args) || abort("\n== Command #{args} failed ==")
end

directory = Dir.pwd.include?('rad_common') ? "#{Dir.pwd}/spec/dummy" : Dir.pwd
FileUtils.chdir directory do
  puts "\n== Removing old logs and tempfiles =="

  system 'rm -rf -v log/'
  system 'rm -rf -v tmp/'
  system 'rm -rf -v storage/'

  puts "== Updating the rad_common gem conservatively =="
  system 'bundle update rad_common --conservative'

  puts "== Updating Binstubs =="
  system 'bundle binstubs rad_common'

  puts "== Running RC Generator =="
  system 'bin/rails g rad_common:install'
end
