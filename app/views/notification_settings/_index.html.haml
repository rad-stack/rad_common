- can_create = policy(NotificationSetting.new).new?
- can_type = policy(NotificationType.new).update?

.card-body
  %table.table.table-striped.table-bordered
    %tr
      %th Notification
      %th
        Enabled
        %p Email/SMS/Feed

    - settings.each do |record|
      - setting_id_string = record.notification_type.description.parameterize.underscore
      %tr
        %td
          - if can_type
            = link_to record.notification_type,
                      "/rad_common/notification_types/#{record.notification_type_id}/edit"
          - else
            = record.notification_type
        %td
          - if can_create && policy(record).create?
            = simple_form_for record,
                              url: '/rad_common/notification_settings',
                              method: :post,
                              html: { class: 'dynamic-updater' } do |f|

              = rad_form_errors f
              .row
                .col-lg
                  = f.input :enabled,
                            tooltip: 'Turn this notification on or off.',
                            input_html: { class: 'ays-ignore',
                                          id: "notification_setting_enabled_#{setting_id_string}" }
              .row
                .col-lg-12
                  .form-inline#notification-settings
                    = f.input :email, tooltip: 'Enable email notifications.',
                                      input_html: { class: 'ays-ignore',
                                                    id: "notification_setting_email_#{setting_id_string}" },
                                      disabled: !record.notification_type.email_enabled?

                    - if RadTwilio.new.twilio_enabled?
                      = f.input :sms, tooltip: 'Enable SMS (text message) notifications.',
                                      input_html: { class: 'ays-ignore',
                                                    id: "notification_setting_sms_#{setting_id_string}" },
                                      disabled: !record.notification_type.sms_enabled?

                    = f.input :feed,
                              tooltip: 'Show a red badge on the top right navigation when a notification occurs.',
                              input_html: { class: 'ays-ignore',
                                            id: "notification_setting_feed_#{setting_id_string}" },
                              disabled: !record.notification_type.feed_enabled?

              = f.association :notification_type, as: :hidden
              = f.input :user_id, as: :hidden
          - else
            = format_boolean(record.enabled)
            %p
            = format_boolean(record.email)
            = format_boolean(record.sms)
            = format_boolean(record.feed)
