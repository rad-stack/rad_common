- presenter = ColumnsSectionPresenter.new(self, custom_report)

= turbo_frame_tag 'report_columns_section' do
  .row
    .col-md-6
      %h6.mb-2
        Available Columns
      .card.shadow-sm
        .card-body.p-0
          .row.g-0
            .col-4.border-end.bg-light
              .list-group.list-group-flush.report-builder-tables-list{ role: 'tablist',
                                                                       data: { testid: 'available-tables-list' } }
                - presenter.columns_by_table.each do |table_info, _cols|
                  - table_id = presenter.table_id_for(table_info)
                  %button{ type: 'button',
                           class: presenter.table_button_classes(table_info),
                           role: 'tab',
                           data: { bs_toggle: 'tab',
                                   bs_target: "#columns-#{table_id}" },
                           aria: { controls: "columns-#{table_id}",
                                   selected: presenter.base_table?(table_info).to_s } }
                    %i.a.fa-table.me-2.text-muted
                    = table_info[:label]
            .col-8
              .tab-content.report-builder-tables-list.p-3
                - presenter.columns_by_table.each do |table_info, cols|
                  - table_id = presenter.table_id_for(table_info)
                  .tab-pane.fade{ id: "columns-#{table_id}",
                                  class: presenter.table_tab_classes(table_info),
                                  role: 'tabpanel' }
                    %table.table.table-sm.table-hover.mb-0
                      %thead
                        %tr
                          %th.py-2.ps-2 Column Name
                          %th.py-2 Type
                          %th.py-2
                      %tbody{ id: "available-columns-#{table_id}" }
                        = render_columns(cols, presenter.selected_column_keys, table_id)

    .col-md-6
      .d-flex.justify-content-between.align-items-center.mb-2
        %h6.mb-0
          Selected Columns
        %button.btn.btn-sm.btn-outline-primary{ type: 'button',
                                                data: {
                                                  action: 'click->report-builder#loadCalculatedColumnForm',
                                                  calculated_column_url: presenter.calculated_column_url,
                                                  bs_toggle: 'modal',
                                                  bs_target: '#calculated-column-modal'
                                                },
                                                title: 'Add calculated column' }
          %i.fa.fa-calculator.me-1
          Add Calculated
      .card.shadow-sm
        .card-body.p-3
          .report-builder-tables-list#selected-columns-container
            %table.table.table-hover.mb-0
              %thead
                %tr
                  %th.py-2.ps-2
                  %th.py-2 Label
                  %th.py-2 Column
                  %th.py-2 Type
                  %th.text-center.py-2 Transforms
                  %th.text-center.py-2 Sortable
                  %th.py-2
              %tbody#selected-columns-list{ data: { controller: 'sortable',
                                                    sortable_dragging_class: 'is-dragging',
                                                    report_builder_target: 'selected-columns-list' } }
                - presenter.selected_columns_config.each do |col_config|
                  - result = presenter.build_selected_column(col_config)
                  - next if result.nil?

                  = render 'selected_column_row', column: result[:column], table_id: result[:table_id], formula: result[:formula]

  = render 'calculated_column_modal'
