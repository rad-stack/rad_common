

= simple_form_for custom_report,
                  url: custom_report.persisted? ? custom_report_path(custom_report) : custom_reports_path,
                  local: true,
                  html: { data: { controller: 'report-builder formula-editor',
                                  action: 'submit->report-builder#submitForm',
                                  report_builder_filter_types_map_value: filter_types_map.to_json,
                                  formula_editor_config_value: RadReports::FormulaRegistry.to_json_config } } do |f|
  = rad_form_errors f

  %div{ data: { report_builder_target: 'hiddenColumnsConfig' } }

  = render 'formula_editor'

  .row
    .col-md-6
      = f.input :report_model,
                label: 'Base Model',
                collection: available_models,
                selected: custom_report.report_model,
                include_blank: 'Select a model to report on',
                disabled: @custom_report.persisted?,
                required: true,
                input_html: { class: 'selectpicker ays-ignore',
                              data: { report_builder_target: 'modelSelect',
                                      action: 'change->report-builder#modelChanged' } }
    .col-md-6= f.input :name
    = f.input :description, as: :text, input_html: { class: 'form-control', rows: 2 }

    %hr

  = turbo_frame_tag 'report_model_context', data: { report_builder_target: 'modelContextFrame' } do
    - if custom_report.report_model.present?
      = render 'model_context_sections', custom_report: custom_report
